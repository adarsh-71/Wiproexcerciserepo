
<h2 class="mb-4">Admin Dashboard</h2>
<ul class="nav nav-tabs mb-4">
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'products'" (click)="activeTab = 'products'">Products</button>
  </li>
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'users'" (click)="activeTab = 'users'">Users</button>
  </li>
  <li class="nav-item">
    <button class="nav-link" [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">Orders</button>
  </li>
</ul>

@if (activeTab === 'products') {
  <div>
    <h3>Manage Products</h3>
    <div class="card mb-4">
      <div class="card-header">
        <h5>Add New Product</h5>
      </div>
      <div class="card-body">
        <form (ngSubmit)="createProduct()" class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" [(ngModel)]="newProduct.name" name="name" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Price</label>
            <input type="number" class="form-control" [(ngModel)]="newProduct.price" name="price" required min="0" step="0.01">
          </div>
          <div class="col-md-4">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" [(ngModel)]="newProduct.quantity" name="quantity" required min="0">
          </div>
          <div class="col-12">
            <label class="form-label">Description</label>
            <textarea class="form-control" [(ngModel)]="newProduct.description" name="description" rows="3"></textarea>
          </div>
          <div class="col-12">
            <label class="form-label">Image URL</label>
            <input type="url" class="form-control" [(ngModel)]="newProduct.imageUrl" name="imageUrl" placeholder="https://example.com/image.jpg">
          </div>
          @if (newProduct.imageUrl) {
            <div class="col-12">
              <label class="form-label">Image Preview</label>
              <div class="image-preview">
                <img [src]="newProduct.imageUrl" alt="Product preview" class="img-thumbnail" (error)="handleImageError($event)">
                <div class="image-error" style="display: none;">
                  <span class="text-danger">Invalid image URL</span>
                </div>
              </div>
            </div>
          }
          <div class="col-12">
            <button type="submit" class="btn btn-primary">Add Product</button>
          </div>
        </form>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Image</th>
            <th>ID</th>
            <th>Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (product of products; track product.id) {
            <tr>
              <td>
                @if (product.imageUrl) {
                  <img [src]="product.imageUrl" [alt]="product.name" class="product-thumb" (error)="handleImageError($event)">
                  <div class="image-placeholder-small" style="display: none;">No Image</div>
                } @else {
                  <div class="image-placeholder-small">No Image</div>
                }
              </td>
              <td>{{ product.id }}</td>
              <td>{{ product.name }}</td>
              <td>{{ product.description | slice:0:50 }}{{ product.description.length > 50 ? '...' : '' }}</td>
              <td>${{ product.price | number:'1.2-2' }}</td>
              <td>{{ product.quantity }}</td>
              <td>
                <button class="btn btn-sm btn-primary me-2" (click)="editProduct(product)">Edit</button>
                <button class="btn btn-sm btn-danger" (click)="deleteProduct(product.id!)">Delete</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
    @if (editingProduct) {
      <div class="modal show d-block" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Product</h5>
              <button type="button" class="btn-close" (click)="editingProduct = null"></button>
            </div>
            <div class="modal-body">
              <form (ngSubmit)="updateProduct()">
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" [(ngModel)]="editingProduct.name" name="name" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" [(ngModel)]="editingProduct.description" name="description" rows="3"></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Price</label>
                  <input type="number" class="form-control" [(ngModel)]="editingProduct.price" name="price" required min="0" step="0.01">
                </div>
                <div class="mb-3">
                  <label class="form-label">Quantity</label>
                  <input type="number" class="form-control" [(ngModel)]="editingProduct.quantity" name="quantity" required min="0">
                </div>
                <div class="mb-3">
                  <label class="form-label">Image URL</label>
                  <input type="url" class="form-control" [(ngModel)]="editingProduct.imageUrl" name="imageUrl" placeholder="https://example.com/image.jpg">
                </div>
                @if (editingProduct.imageUrl) {
                  <div class="mb-3">
                    <label class="form-label">Image Preview</label>
                    <div class="image-preview">
                      <img [src]="editingProduct.imageUrl" alt="Product preview" class="img-thumbnail" (error)="handleImageError($event)">
                      <div class="image-error" style="display: none;">
                        <span class="text-danger">Invalid image URL</span>
                      </div>
                    </div>
                  </div>
                }
                <button type="submit" class="btn btn-primary">Update</button>
                <button type="button" class="btn btn-secondary ms-2" (click)="editingProduct = null">Cancel</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-backdrop show"></div>
    }
  </div>
} @else if (activeTab === 'users') {
  <div>
    <h3>Manage Users</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Address</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users; track user.id) {
            <tr>
              <td>{{ user.id }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.role }}</td>
              <td>{{ user.address || 'No address provided' }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
} @else if (activeTab === 'orders') {
  <div>
    <h3>Manage Orders</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>User ID</th>
            <th>Total Amount</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (order of orders; track order.id) {
            <tr>
              <td>{{ order.id }}</td>
              <td>{{ order.userId }}</td>
              <td>${{ order.totalAmount | number:'1.2-2' }}</td>
              <td>
                <select class="form-select" [value]="order.status" (change)="updateOrderStatus(order, $any($event.target).value)">
                  <option value="PENDING">Pending</option>
                  <option value="PROCESSING">Processing</option>
                  <option value="SHIPPED">Shipped</option>
                  <option value="DELIVERED">Delivered</option>
                  <option value="CANCELLED">Cancelled</option>
                </select>
              </td>
              <td>{{ order.createdAt | date:'medium' }}</td>
              <td>
                <button class="btn btn-sm btn-info" [routerLink]="['/orders', order.id]">View</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
}